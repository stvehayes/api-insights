import React from 'react';
import '../theme.js';
import '../constants.js';
import '../BaseStyles.js';
import '../ThemeProvider.js';
import Box from '../Box/Box.js';
import '@styled-system/css';
import merge from 'deepmerge';
import '../Button/types.js';
import '../utils/defaultSxProp.js';
import '../CounterLabel/CounterLabel.js';
import '../Button/Button.js';
import '../PageLayout/PageLayout.js';
import '../SplitPageLayout/SplitPageLayout.js';
import '@primer/behaviors/utils';
import '../ConfirmationDialog/ConfirmationDialog.js';
import '@primer/behaviors';
import { useResponsiveValue } from '../hooks/useResponsiveValue.js';
import '../Radio/Radio.js';
import '../ActionList/index.js';
import '../ActionMenu/ActionMenu.js';
import '../AnchoredOverlay/AnchoredOverlay.js';
import '../Autocomplete/Autocomplete.js';
import '../Avatar/Avatar.js';
import '../AvatarPair/AvatarPair.js';
import '../AvatarStack/AvatarStack.js';
import '../BranchName/BranchName.js';
import '../Breadcrumbs/Breadcrumbs.js';
import '../ButtonGroup/ButtonGroup.js';
import '../Caret.js';
import '../CircleOcticon/CircleOcticon.js';
import '../CheckboxGroup/CheckboxGroup.js';
import '../CircleBadge/CircleBadge.js';
import '../Details/Details.js';
import '../Dialog.js';
import '../Flash/Flash.js';
import '../FormControl/_FormControlContext.js';
import '../FormControl/FormControl.js';
import '../Header/Header.js';
import Heading from '../Heading/Heading.js';
import '../Label/Label.js';
import '../LabelGroup/LabelGroup.js';
import Link from '../Link/Link.js';
import '../NavList/NavList.js';
import '../Octicon/Octicon.js';
import '../Overlay/Overlay.js';
import '../Pagehead/Pagehead.js';
import '../Pagination/Pagination.js';
import '../PointerBox/PointerBox.js';
import '../Popover/Popover.js';
import 'react-dom';
import '../ProgressBar/index.js';
import '../RadioGroup/RadioGroup.js';
import '../RelativeTime/RelativeTime.js';
import '../SegmentedControl/SegmentedControl.js';
import '../Select.js';
import '../SelectPanel/SelectPanel.js';
import '../SideNav.js';
import '../Spinner/Spinner.js';
import '../StateLabel/StateLabel.js';
import '../SubNav/SubNav.js';
import '../ToggleSwitch/ToggleSwitch.js';
import '../TabNav/TabNav.js';
import '../TextInput/TextInput.js';
import '../TextInputWithTokens/TextInputWithTokens.js';
import '../Text/Text.js';
import '../Timeline/Timeline.js';
import '../Token/Token.js';
import '../Token/IssueLabelToken.js';
import '../Token/AvatarToken.js';
import '../Tooltip/Tooltip.js';
import '../Truncate/Truncate.js';
import '../Checkbox/Checkbox.js';
import '../Textarea/Textarea.js';
import '../TreeView/TreeView.js';
import '../UnderlineNav/index.js';
import { ArrowLeftIcon } from '@primer/octicons-react';
import { getBreakpointDeclarations } from '../utils/getBreakpointDeclarations.js';

const REGION_ORDER = {
  ContextArea: 0,
  TitleArea: 1,
  Description: 2,
  Navigation: 3
};
const CONTEXT_AREA_REGION_ORDER = {
  ParentLink: 0,
  ContextBar: 1,
  ContextAreaActions: 2
};
const TITLE_AREA_REGION_ORDER = {
  LeadingAction: 0,
  LeadingVisual: 1,
  Title: 2,
  TrailingVisual: 3,
  TrailingAction: 4,
  Actions: 5
};

// Types that are shared between PageHeader children components

// Default state for the `visible` prop when a sub component is only visible on narrow viewport
const hiddenOnRegularAndWide = {
  narrow: false,
  regular: true,
  wide: true
};

// Default state for the `visible` prop when a sub component is visible on regular and wide viewport
const hiddenOnNarrow = {
  narrow: true,
  regular: false,
  wide: false
};

// Root
// -----------------------------------------------------------------------------

const Root = ({
  children,
  sx = {},
  as = 'div'
}) => {
  const rootStyles = {
    display: 'flex',
    flexDirection: 'column',
    // TODO: We used hard-coded values for the spacing and font size in this component. Update them to use new design tokens when they are ready to use.
    gap: '0.5rem'
  };
  return /*#__PURE__*/React.createElement(Box, {
    as: as,
    sx: merge(rootStyles, sx)
  }, children);
};
Root.displayName = "Root";
// PageHeader.ContextArea : Only visible on narrow viewports by default to provide user context of where they are at their journey. `hidden` prop available
// to manage their custom visibility but consumers should be careful if they choose to hide this on narrow viewports.
// PageHeader.ContextArea Sub Components: PageHeader.ParentLink, PageHeader.ContextBar, PageHeader.ContextAreaActions
// ---------------------------------------------------------------------
const ContextArea = ({
  children,
  hidden = hiddenOnRegularAndWide,
  sx = {}
}) => {
  const contentNavStyles = {
    display: 'flex',
    flexDirection: 'row',
    alignItems: 'center',
    gap: '0.5rem',
    order: REGION_ORDER.ContextArea,
    ...getBreakpointDeclarations(hidden, 'display', value => {
      return value ? 'none' : 'flex';
    })
  };
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge(contentNavStyles, sx)
  }, children);
};
ContextArea.displayName = "ContextArea";
// PageHeader.ParentLink : Only visible on narrow viewports by default to let users navigate up in the hierarchy.
const ParentLink = /*#__PURE__*/React.forwardRef(({
  children,
  sx = {},
  href,
  'aria-label': ariaLabel,
  as = 'a',
  hidden = hiddenOnRegularAndWide
}, ref) => {
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Link, {
    ref: ref,
    as: as,
    "aria-label": ariaLabel,
    muted: true,
    sx: merge({
      display: 'flex',
      alignItems: 'center',
      order: CONTEXT_AREA_REGION_ORDER.ParentLink,
      gap: '0.5rem',
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      })
    }, sx),
    href: href
  }, /*#__PURE__*/React.createElement(ArrowLeftIcon, null), /*#__PURE__*/React.createElement(Box, null, children)));
});

// ContextBar
// Generic slot for any component above the title region. Use it for custom breadcrumbs and other navigation elements instead of ParentLink.
// ---------------------------------------------------------------------

const ContextBar = ({
  children,
  sx = {},
  hidden = hiddenOnRegularAndWide
}) => {
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: CONTEXT_AREA_REGION_ORDER.ContextBar,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      })
    }, sx)
  }, children);
};
ContextBar.displayName = "ContextBar";
// ContextAreaActions
// ---------------------------------------------------------------------
const ContextAreaActions = ({
  children,
  sx = {},
  hidden = hiddenOnRegularAndWide
}) => {
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      flexDirection: 'row',
      order: CONTEXT_AREA_REGION_ORDER.ContextAreaActions,
      alignItems: 'center',
      gap: '0.5rem',
      flexGrow: '1',
      justifyContent: 'right',
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      })
    }, sx)
  }, children);
};
ContextAreaActions.displayName = "ContextAreaActions";
const MEDIUM_TITLE_HEIGHT = '2rem';
const LARGE_TITLE_HEIGHT = '3rem';
const TitleAreaContext = /*#__PURE__*/React.createContext({
  titleVariant: 'medium',
  titleAreaHeight: MEDIUM_TITLE_HEIGHT
});
// PageHeader.TitleArea: The main title area of the page. Visible on all viewports.
// PageHeader.TitleArea Sub Components: PageHeader.LeadingAction, PageHeader.LeadingVisual,
// PageHeader.Title, PageTitle.TrailingVisual, PageHeader.TrailingAction, PageHeader.Actions
// ---------------------------------------------------------------------

const TitleArea = ({
  children,
  sx = {},
  hidden = false,
  variant = 'medium'
}) => {
  const currentVariant = useResponsiveValue(variant, 'medium');
  const height = currentVariant === 'large' ? LARGE_TITLE_HEIGHT : MEDIUM_TITLE_HEIGHT;
  return /*#__PURE__*/React.createElement(TitleAreaContext.Provider, {
    value: {
      titleVariant: currentVariant,
      titleAreaHeight: height
    }
  }, /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      gap: '0.5rem',
      order: REGION_ORDER.TitleArea,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      flexDirection: 'row',
      alignItems: 'flex-start'
    }, sx)
  }, children));
};
TitleArea.displayName = "TitleArea";
// PageHeader.LeadingAction and PageHeader.TrailingAction should only be visible on regular viewports.
// So they come as hidden on narrow viewports by default and their visibility can be managed by their `hidden` prop.
const LeadingAction = ({
  children,
  sx = {},
  hidden = hiddenOnNarrow
}) => {
  const {
    titleAreaHeight
  } = React.useContext(TitleAreaContext);
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: TITLE_AREA_REGION_ORDER.LeadingAction,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      alignItems: 'center',
      height: titleAreaHeight
    }, sx)
  }, children);
};
LeadingAction.displayName = "LeadingAction";
// PageHeader.LeadingVisual and PageHeader.TrailingVisual should remain visible on narrow viewports.
const LeadingVisual = ({
  children,
  sx = {},
  hidden = false
}) => {
  const {
    titleAreaHeight
  } = React.useContext(TitleAreaContext);
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: TITLE_AREA_REGION_ORDER.LeadingVisual,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      alignItems: 'center',
      height: titleAreaHeight
    }, sx)
  }, children);
};
LeadingVisual.displayName = "LeadingVisual";
const Title = ({
  children,
  sx = {},
  hidden = false,
  as = 'h2'
}) => {
  const {
    titleVariant
  } = React.useContext(TitleAreaContext);
  return /*#__PURE__*/React.createElement(Heading, {
    as: as,
    sx: merge({
      fontSize: {
        large: '2rem',
        medium: '1.25rem',
        subtitle: '1.25rem'
      }[titleVariant],
      // line-height is calculated with calc(height/font-size) and the below numbers are from @primer/primitives
      lineHeight: {
        large: 1.5,
        // calc(48/32)
        medium: 1.6,
        // calc(32/20)
        subtitle: 1.6 // calc(32/20)
      }[titleVariant],
      fontWeight: {
        large: '400',
        medium: '600',
        subtitle: '400'
      }[titleVariant],
      display: 'flex',
      order: TITLE_AREA_REGION_ORDER.Title,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      })
    }, sx)
  }, children);
};
Title.displayName = "Title";
// PageHeader.LeadingVisual and PageHeader.TrailingVisual should remain visible on narrow viewports.
const TrailingVisual = ({
  children,
  sx = {},
  hidden = false
}) => {
  const {
    titleAreaHeight
  } = React.useContext(TitleAreaContext);
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: TITLE_AREA_REGION_ORDER.TrailingVisual,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      alignItems: 'center',
      height: titleAreaHeight
    }, sx)
  }, children);
};
TrailingVisual.displayName = "TrailingVisual";
const TrailingAction = ({
  children,
  sx = {},
  hidden = hiddenOnNarrow
}) => {
  const {
    titleAreaHeight
  } = React.useContext(TitleAreaContext);
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: TITLE_AREA_REGION_ORDER.TrailingAction,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      alignItems: 'center',
      height: titleAreaHeight
    }, sx)
  }, children);
};
TrailingAction.displayName = "TrailingAction";
const Actions = ({
  children,
  sx = {},
  hidden = false
}) => {
  const {
    titleAreaHeight
  } = React.useContext(TitleAreaContext);
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: TITLE_AREA_REGION_ORDER.Actions,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      flexDirection: 'row',
      gap: '0.5rem',
      flexGrow: '1',
      justifyContent: 'right',
      height: titleAreaHeight,
      alignItems: 'center'
    }, sx)
  }, children);
};
Actions.displayName = "Actions";
// PageHeader.Description: The description area of the header. Visible on all viewports
const Description = ({
  children,
  sx = {},
  hidden = false
}) => {
  return /*#__PURE__*/React.createElement(Box, {
    sx: merge({
      display: 'flex',
      order: REGION_ORDER.Description,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'flex';
      }),
      flexDirection: 'row',
      alignItems: 'center',
      gap: '0.5rem'
    }, sx)
  }, children);
};
Description.displayName = "Description";
// PageHeader.Navigation: The local navigation area of the header. Visible on all viewports
const Navigation = ({
  children,
  sx = {},
  hidden = false,
  as,
  'aria-label': ariaLabel,
  'aria-labelledby': ariaLabelledBy
}) => {
  // TODO: use warning utility function when it is merged https://github.com/primer/react/pull/2901/
  if (process.env.NODE_ENV !== "production") {
    if (as === 'nav' && !ariaLabel && !ariaLabelledBy) {
      // eslint-disable-next-line no-console
      console.warn('Use `aria-label` or `aria-labelledby` prop to provide an accessible label to the `nav` landmark for assistive technology');
    }
  }
  return /*#__PURE__*/React.createElement(Box, {
    as: as
    // Render `aria-label` and `aria-labelledby` only on `nav` elements
    ,
    "aria-label": as === 'nav' ? ariaLabel : undefined,
    "aria-labelledby": as === 'nav' ? ariaLabelledBy : undefined,
    sx: merge({
      display: 'flex',
      order: REGION_ORDER.Navigation,
      ...getBreakpointDeclarations(hidden, 'display', value => {
        return value ? 'none' : 'block';
      })
    }, sx)
  }, children);
};
Navigation.displayName = "Navigation";
const PageHeader = Object.assign(Root, {
  ContextArea,
  ParentLink,
  ContextBar,
  ContextAreaActions,
  TitleArea,
  LeadingAction,
  LeadingVisual,
  Title,
  TrailingVisual,
  TrailingAction,
  Actions,
  Description,
  Navigation
});

export { PageHeader };
